version: "3"

services:
  dev:
    build:
      context: .
      dockerfile: dev.Dockerfile
    image: ${NICKNAME:?err}/${PROJECT_NAME:?err}-dev
    container_name: ${NICKNAME:?err}-${PROJECT_NAME:?err}-dev
    ports:
      - "${SSH_PORT:?err}:22"
      - "${API_PORT:?err}:3000"
      - "${WEB_PORT:?err}:5173"
    tty: true
    depends_on:
      - db
      - redis
    volumes:
      - root:/root
      - .:/usr/src

  db:
    image: mysql:8.0
    container_name: ${NICKNAME:?err}-${PROJECT_NAME:?err}-db
    ports:
      - "${DB_PORT}:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=${DB_PASSWORD:?err}
      - MYSQL_DATABASE=${DB_NAME:?err}
    volumes:
      - db:/var/lib/mysql
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

  redis:
    image: redis:7.0
    container_name: ${NICKNAME:?err}-${PROJECT_NAME:?err}-redis
    ports:
      - "${REDIS_PORT}:6379"
    volumes:
      - redis:/data

volumes:
  root:
    name: "${NICKNAME:?err}-${PROJECT_NAME:?err}-root"
  db:
    name: "${NICKNAME:?err}-${PROJECT_NAME:?err}-db"
  redis:
    name: "${NICKNAME:?err}-${PROJECT_NAME:?err}-redis"
